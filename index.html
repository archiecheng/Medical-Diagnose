<!--
 * @Author: archiecheng archiechengice@outlook.com
 * @Date: 2024-08-02 20:16:20
 * @LastEditors: archiecheng archiechengice@outlook.com
 * @LastEditTime: 2024-08-18 14:43:49
 * @FilePath: \medical_diagnose\index.html
 * @Description: 这是默认设置,请设置`customMade`, 打开koroFileHeader查看配置 进行设置: https://github.com/OBKoro1/koro1FileHeader/wiki/%E9%85%8D%E7%BD%AE
-->
<!DOCTYPE html>
<html>
  <head>
    <title>Medical Diagnose</title>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <script src="./assets/jquery/jquery.min.js"></script>
    <style>
      * {
        margin: 0;
        padding: 0;
      }

      html {
        font-size: 16px; /* 基准字体大小 */
      }

      @media (max-width: 1200px) {
        html {
          font-size: 14px; /* 调整较小屏幕上的基准字体大小 */
        }
      }

      @media (max-width: 768px) {
        html {
          font-size: 12px; /* 更小屏幕上的基准字体大小 */
        }
      }

      @media (max-width: 480px) {
        html {
          font-size: 10px; /* 最小屏幕的基准字体大小 */
        }
      }

      /* 整体布局 */
      .layout {
        height: 100vh;
        display: flex;
        position: relative;
        font-size: 1rem; /* 1rem 相当于根字体大小 */
      }

      .side_bar {
        background-color: #eceeff;
        box-sizing: border-box;
        width: 12.5rem; /* 200px 转换为 rem */
        padding: 1.25rem; /* 20px 转换为 rem */
        transition: all 0.6s ease-in-out;
        position: relative;
        overflow: hidden;
        white-space: nowrap;
        text-overflow: ellipsis;
        flex: 0.5;
        height: 100%;
      }

      .chat_content {
        background: url("./assets/images/background.png") no-repeat center
          center;
        flex-grow: 1;
        background-size: cover;
        display: flex;
        justify-content: center;
        align-items: center;
        height: 100%;
      }

      /* 左侧布局 */
      .side_bar.hidden {
        width: 0;
        padding: 0;
        flex: 0;
        transition: all 0.6s ease-in-out;
      }

      .layout .toggle_img {
        position: absolute;
        top: 0.625rem; /* 10px 转换为 rem */
        left: 0.9375rem; /* 15px 转换为 rem */
        width: 1.5625rem; /* 25px 转换为 rem */
        height: 1.25rem; /* 20px 转换为 rem */
        cursor: pointer;
        padding: 0.1875rem; /* 3px 转换为 rem */
        border: 0.125rem solid transparent; /* 2px 转换为 rem */
        transition: border-color 0.6s ease-in-out, left 0.6s ease-in-out,
          background-color 0.6s ease-in-out;
        z-index: 999;
      }

      .layout .toggle_img:hover {
        background-color: rgba(0, 0, 0, 0.2);
        border-radius: 0.3125rem; /* 5px 转换为 rem */
      }

      .side_bar ul {
        list-style: none;
        margin-top: 3.125rem; /* 50px 转换为 rem */
      }

      .side_bar ul li {
        margin-bottom: 0.9375rem; /* 15px 转换为 rem */
      }

      .side_bar ul li a {
        text-decoration: none;
        color: rgb(99, 106, 154);
        display: block;
        overflow: hidden;
        text-overflow: ellipsis;
      }

      /* 右侧布局 */
      .chat_content {
        display: flex;
        flex-direction: column;
        justify-content: space-between;
        align-items: center;
        flex: 3;
      }

      .chat_content .message_container {
        position: relative;
        width: 100%;
        height: calc(100vh - 4.375rem); /* 70px 转换为 rem */
      }

      .message_tip {
        position: absolute;
        left: 0.625rem; /* 10px 转换为 rem */
        top: 1.875rem; /* 30px 转换为 rem */
        font-size: 3.75rem; /* 60px 转换为 rem */
        font-family: "League Spartan";
        font-weight: bold;
      }

      .message_area {
        width: 100%;
        height: 100%;
      }

      .message_list {
        width: 100%;
        height: 100%;
        position: relative;
        box-sizing: border-box;
        overflow: auto;
        border-width: 0px;
        display: flex;
        flex-direction: column;
      }

      .message_left {
        width: 100%;
        height: 7.5rem; /* 120px 转换为 rem */
        margin-top: 1.25rem; /* 20px 转换为 rem */
      }

      .message_left_item {
        width: 55%;
        height: 6.25rem; /* 100px 转换为 rem */
        float: left;
        margin-top: 0.625rem; /* 10px 转换为 rem */
        margin-left: 1.25rem; /* 20px 转换为 rem */
      }

      .message_left_item .message_left_content {
        position: relative;
        padding: 0.9375rem; /* 15px 转换为 rem */
        margin-top: 0.625rem; /* 10px 转换为 rem */
        display: inline-block;
        border-top-left-radius: 0px;
        background: #e0e6ff;
        border-radius: 1rem; /* 16px 转换为 rem */
        padding: 0.625rem 1.25rem; /* 10px 和 20px 转换为 rem */
        color: #888;
        font-family: Arial, sans-serif;
        font-size: 1.125rem; /* 18px 转换为 rem */
        width: fit-content;
        box-shadow: 0 0.125rem 0.625rem rgba(0, 0, 0, 0.1); /* 2px 和 10px 转换为 rem */
      }

      .message_left_item .message_left_content:before {
        content: "";
        position: absolute;
        top: 0.625rem; /* 10px 转换为 rem */
        left: -0.9375rem; /* 15px 转换为 rem */
        width: 0;
        height: 0;
        border-style: solid;
        border-width: 0.625rem 1.25rem 0.625rem 0; /* 10px 和 20px 转换为 rem */
        border-color: transparent #e0e6ff transparent transparent;
      }

      /* 右边 */
      .message_right {
        width: 100%;
        height: 7.5rem; /* 120px 转换为 rem */
        margin-top: 1.25rem; /* 20px 转换为 rem */
      }

      .message_right_avatar {
        width: 3.125rem; /* 50px 转换为 rem */
        height: 3.125rem; /* 50px 转换为 rem */
        margin-left: 1.875rem; /* 30px 转换为 rem */
        float: right;
        color: white;
        border-radius: 50%;
        position: relative;
      }

      .message_right_avatar img {
        width: 100%;
        height: 100%;
      }

      .message_right_item {
        width: 55%;
        height: 6.25rem; /* 100px 转换为 rem */
        float: right;
        margin-top: 0.625rem; /* 10px 转换为 rem */
        margin-right: 0.625rem; /* 10px 转换为 rem */
        display: flex;
        justify-content: flex-end;
        align-items: center;
      }

      .message_right_content {
        position: relative;
        float: right;
        margin-right: 0.3125rem; /* 5px 转换为 rem */
        background: #e0e6ff;
        border-radius: 1rem; /* 16px 转换为 rem */
        padding: 0.625rem 1.25rem; /* 10px 和 20px 转换为 rem */
        color: #888;
        font-family: Arial, sans-serif;
        font-size: 1.125rem; /* 18px 转换为 rem */
        width: fit-content;
        box-shadow: 0 0.25rem 0.5rem rgba(0, 0, 0, 0.1); /* 4px 和 8px 转换为 rem */
      }

      .message_right_content:after {
        content: "";
        position: absolute;
        top: 50%;
        right: -1rem; /* 20px 转换为 rem */
        transform: translateY(-50%);
        width: 0;
        height: 0;
        border-style: solid;
        border-width: 0.625rem 0 0.625rem 1.25rem; /* 10px 和 20px 转换为 rem */
        border-color: transparent transparent transparent #e0e6ff;
      }

      .chat_content .send_message {
        background-image: linear-gradient(#636a9a, #d7d8ff);
        width: 100%;
        height: 4.375rem; /* 70px 转换为 rem */
        display: flex;
        justify-content: space-between;
        align-items: center;
        box-sizing: border-box;
        padding: 1.25rem; /* 20px 转换为 rem */
      }

      .send_message input {
        border-radius: 0.625rem; /* 10px 转换为 rem */
        height: 1.875rem; /* 30px 转换为 rem */
        border: 0;
        outline: none;
        box-sizing: border-box;
        padding-left: 0.3125rem; /* 5px 转换为 rem */
        flex: 1;
        margin-right: 1.25rem; /* 20px 转换为 rem */
      }

      .send_message .send_button {
        width: 2.5rem; /* 40px 转换为 rem */
        height: 1.5625rem; /* 25px 转换为 rem */
        border-radius: 50%;
        background-color: #636a9a;
        display: flex;
        justify-content: center;
        align-items: center;
        color: white;
        cursor: pointer;
      }

      .content_hidden {
        display: none;
      }

      .content_show {
        display: block;
      }

      .result_content {
        flex: 1;
        background-image: linear-gradient(
          to right,
          rgba(99, 106, 154, 0.8),
          #d7d8ff
        );
        flex-grow: 1.5;
        background-size: cover;
        height: 100vh;
        overflow-y: scroll;
        scroll-snap-type: y mandatory;
        -ms-overflow-style: none; /* IE 和 Edge 隐藏滚动条 */
        scrollbar-width: none; /* Firefox 隐藏滚动条 */
        scroll-behavior: smooth;
      }

      .result_content::-webkit-scrollbar {
        display: none; /* Chrome, Safari, Opera 隐藏滚动条 */
      }

      .result_card {
        width: 100%;
        height: 100vh;
        display: flex;
        flex-direction: column;
        justify-content: space-around;
        align-items: center;
        box-sizing: border-box;
        scroll-snap-align: start;
        padding: 1.5rem; /* 40px 转换为 rem */
      }

      .result_header {
        background-color: transparent;
        font-size: 2.5rem; /* 45px 转换为 rem */
        font-family: "League Spartan";
        font-weight: bold;
        margin-bottom: 1rem;
        text-align: left;
        width: 100%;
        /* margin-bottom: 1rem; 30px 转换为 rem */
      }

      .result_main {
        background-color: white;
        position: relative;
        border-radius: 1.875rem; /* 30px 转换为 rem */
        box-sizing: border-box;
        padding: 1.2rem; /* 25px 转换为 rem */
      }

      .result_name {
        font-size: 2.8125rem; /* 45px 转换为 rem */
        font-family: "League Spartan";
        font-weight: bold;
        position: absolute;
        top: -2.5rem; /* 40px 转换为 rem */
        left: 16.25rem; /* 260px 转换为 rem */
      }

      .result_brief_intro {
        color: #676778;
        font-family: "DM Sans";
        font-size: 1.25rem; /* 20px 转换为 rem */
        margin-bottom: 0.625rem; /* 10px 转换为 rem */
      }

      .result_image {
        margin-bottom: 0.5rem; /* 20px 转换为 rem */
      }

      .result_image img {
        width: 100%;
        height: 15.625rem; /* 250px 转换为 rem */
        border-radius: 1.875rem; /* 30px 转换为 rem */
      }

      .split_line {
        border-top: 0.0625rem solid #676778; /* 1px 转换为 rem */
      }

      .symptom_info {
        width: 100%;
      }

      .symptom_intro {
        margin-top: 0.5rem; /* 20px 转换为 rem */
        font-weight: bold;
        color: #676778;
        font-family: "DM Sans";
      }

      .symptom_list {
        display: flex;
        flex-direction: column;
        height: 18.75rem;
        overflow-y: auto;
      }

      .simptom_item {
        display: flex;
        justify-content: space-between;
        align-items: center;
      }

      .symptom_name {
        color: black;
        font-weight: bold;
        font-size: 0.9375rem; /* 15px 转换为 rem */
        width: 9.375rem;
      }

      /* 设置单选框外观为隐藏 */
      .symptom_status input[type="radio"] {
        display: none;
      }

      /* 设置单选框的label外观 */
      .symptom_status input[type="radio"] + label {
        width: 1.875rem; /* 30px 转换为 rem */
        height: 1.875rem; /* 30px 转换为 rem */
        border-radius: 50%;
        display: inline-block;
        border: 0.125rem solid #6c6c6c; /* 2px 转换为 rem */
        cursor: pointer;
        background-color: #f0f0f0;
        margin: 0.3125rem; /* 5px 转换为 rem */
      }

      /* 选中状态下的label样式 */
      .symptom_status input[type="radio"]:checked + label {
        border-color: #6c6c6c;
      }

      /* 单个按钮的颜色 */
      .symptom_status input[type="radio"]:nth-of-type(1):checked + label {
        background-color: #8bc34a; /* 绿色 */
      }

      .symptom_status input[type="radio"]:nth-of-type(2):checked + label {
        background-color: #ffeb3b; /* 黄色 */
      }

      .symptom_status input[type="radio"]:nth-of-type(3):checked + label {
        background-color: #f44336; /* 红色 */
      }

      .scroll_arrow {
        width: 0;
        height: 0;
        border-left: 2rem solid transparent; /* 50px 转换为 rem */
        border-right: 2rem solid transparent; /* 50px 转换为 rem */
        border-top: 2rem solid #6c6c6c; /* 50px 转换为 rem */
        margin: 0.5rem auto; /* 50px 转换为 rem */
      }

      @media (max-width: 768px) {
        .result_content {
          height: auto;
          scroll-snap-type: none;
          overflow-y: auto;
          padding: 0.625rem; /* 10px 转换为 rem */
        }

        .result_card {
          height: auto;
          padding: 1.25rem; /* 20px 转换为 rem */
          margin-bottom: 1.25rem; /* 20px 转换为 rem */
        }

        .result_image img {
          height: auto;
          max-height: 12.5rem; /* 200px 转换为 rem */
          border-radius: 0.9375rem; /* 15px 转换为 rem */
        }

        .symptom_name {
          font-size: 1rem; /* 16px 转换为 rem */
        }

        .symptom_list {
          flex-direction: column;
        }

        .simptom_item {
          display: flex;
          justify-content: space-between;
          align-items: center;
          padding: 0.625rem 0; /* 10px 转换为 rem */
        }

        .symptom_status {
          display: flex;
          gap: 0.625rem; /* 10px 转换为 rem */
        }

        .message_tip {
          font-size: 2.5rem; /* 40px 转换为 rem */
        }
      }
    </style>
  </head>
  <body>
    <div class="layout">
      <img
        src="./assets/images/sidebar-icon.png"
        class="toggle_img"
        id="toggleButton"
      />
      <div class="side_bar" id="sidebar">
        <ul>
          <li class="nav-item">
            <a href="#">Home</a>
          </li>
          <li class="nav-item">
            <a href="#">Symptom Profile</a>
          </li>
          <li class="nav-item">
            <a href="#">Profile</a>
          </li>
          <li class="nav-item">
            <a href="#">Reports</a>
          </li>
          <li class="nav-item">
            <a href="#">Settings</a>
          </li>
          <li class="nav-item">
            <a href="#">Contact</a>
          </li>
        </ul>
      </div>
      <div class="chat_content">
        <div class="message_container">
          <div class="message_tip">
            How Can We <br />
            Help You <br />
            Today? <br />
          </div>
          <div class="message_list" id="message_list_id">
            <!-- 左边 -->
            <div class="message_left clearfix">
              <div class="message_left_item">
                <div class="message_left_content">
                  Please enQter what you have been diagnosed with and any
                  additional information.
                  <a href="#"
                    >Click here for more information on how to use the app.</a
                  >
                </div>
              </div>
            </div>
            <div class="message_left clearfix">
              <div class="message_left_item">
                <div class="message_left_content">
                  <!-- Additional warnings and disclaimers -->
                  Please a disease name
                </div>
              </div>
            </div>
            <!--右边 -->
            <div class="message_right">
              <!-- <div class="message_right_item">
                <div class="message_right_content">Disease Name</div>
                <div class="message_right_avatar">
                  <img src="./assets/images/avatar.png" alt="" />
                </div>
              </div> -->
            </div>
          </div>
        </div>
        <div class="send_message">
          <input
            type="text"
            placeholder="Enter Disease"
            id="send_message_content"
          />
          <div class="send_button" id="button">send</div>
        </div>
      </div>
      <div class="result_content">
        <!-- <div class="result_card">
          <div class="result_header">Symptoms</div>
          <div class="result_main">
            <div class="result_brief_intro">Brief Explanation...</div>
            <div class="result_image">
              <img src="./assets/images/diabetes.jpg" alt="" />
            </div>
            <div class="split_line"></div>
            <div class="symptom_info">
              <div class="symptom_intro">
                For the following symptoms, please select YES|NO|MAYBE according
                to your personal wellbeing
              </div>
              <div class="symptom_list">
                <div class="simptom_item">
                  <div class="symptom_name">Symptom Name</div>
                  <div class="symptom_status">
                    <input type="radio" id="option1" name="options" />
                    <label for="option1"></label>

                    <input type="radio" id="option2" name="options" />
                    <label for="option2"></label>

                    <input type="radio" id="option3" name="options" />
                    <label for="option3"></label>
                  </div>
                </div>
                <div class="simptom_item">
                  <div class="symptom_name">Symptom Name</div>
                  <div class="symptom_status">
                    <input type="radio" id="option1" name="options" />
                    <label for="option1"></label>

                    <input type="radio" id="option2" name="options" />
                    <label for="option2"></label>

                    <input type="radio" id="option3" name="options" />
                    <label for="option3"></label>
                  </div>
                </div>
                <div class="simptom_item">
                  <div class="symptom_name">Symptom Name</div>
                  <div class="symptom_status">
                    <input type="radio" id="option1" name="options" />
                    <label for="option1"></label>

                    <input type="radio" id="option2" name="options" />
                    <label for="option2"></label>

                    <input type="radio" id="option3" name="options" />
                    <label for="option3"></label>
                  </div>
                </div>
                <div class="simptom_item">
                  <div class="symptom_name">Symptom Name</div>
                  <div class="symptom_status">
                    <input type="radio" id="option1" name="options" />
                    <label for="option1"></label>

                    <input type="radio" id="option2" name="options" />
                    <label for="option2"></label>

                    <input type="radio" id="option3" name="options" />
                    <label for="option3"></label>
                  </div>
                </div>
              </div>
            </div>
          </div>
          <div class="scroll_arrow"></div>
        </div> -->
      </div>
    </div>
    <script>
      document.addEventListener("DOMContentLoaded", function () {
        // 检测网页是否在移动端打开
        if (/Mobi|Android|iPhone/i.test(navigator.userAgent)) {
          $(".chat_content").addClass("content_show");
          $(".result_content").addClass("content_hidden");
        }

        // 预加载疾病JSON数据
        var diseasesData = [];

        fetch("assets/data/diseases.json")
          .then((response) => response.json())
          .then((data) => {
            // 在这里处理你的 JSON 数据
            diseasesData = data;
          })
          .catch((error) => {
            console.error("Error loading JSON:", error);
          });

        // 预加载症状JSON数据
        var symptomsData = [];

        fetch("assets/data/symptoms.json")
          .then((response) => response.json())
          .then((data) => {
            // 在这里处理你的 JSON 数据
            symptomsData = data;
          })
          .catch((error) => {
            console.error("Error loading JSON:", error);
          });

        // 1. 侧边栏切换功能
        function toggleSidebar(toggleButtonSelector, sidebarSelector) {
          $(document).ready(function () {
            $(toggleButtonSelector).click(function () {
              $(sidebarSelector).toggleClass("hidden");
            });
          });
        }

        // 2. 发送消息功能
        function sendMessage(chatContainerId, buttonId, messageInputId) {
          var send_message = document.getElementById(chatContainerId);
          var domBtm = document.getElementById(buttonId);
          var message = document.getElementById(messageInputId);

          // 定义一个函数，用于发送消息
          function send() {
            var str = message.value;
            if (str.trim() === "") {
              return; // 如果输入内容为空则不发送消息
            }

            var ans =
              '<div class="message_right_item">' +
              '<div class="message_right_content">' +
              str +
              "</div>" +
              '<div class="message_right_avatar">' +
              '<img src="./assets/images/avatar.png" alt="">' +
              " </div>" +
              "</div>";

            var oLi = document.createElement("div");
            oLi.setAttribute("class", "message_right");
            oLi.innerHTML = ans;
            send_message.append(oLi);
            message.value = "";
            send_message.scrollTop = send_message.scrollHeight;

            var symptoms;
            // 检索疾病名称并显示症状
            setTimeout(function () {
              symptoms = diseasesData[str].Symptom;

              var replyMessage;

              if (symptoms) {
                replyMessage =
                  "Thank you for your message, we are searching now!";
              } else {
                replyMessage =
                  "No relevant symptoms found, please check the disease name.";
              }

              var replyLi = document.createElement("div");
              replyLi.setAttribute("class", "message_left_item");
              replyLi.innerHTML =
                '<div class="message_left_item">' +
                '<div class="message_left_content">' +
                replyMessage +
                "</div>" +
                "</div>";

              send_message.append(replyLi);
              send_message.scrollTop = send_message.scrollHeight;
            }, 1000); // 模拟延迟1秒后回复

            setTimeout(function () {
              // renderOtherDiseasesByKnownDiseaseSymptoms(symptoms);
              renderSymptomsByDiseaseName(str, symptoms);
            }, 1000);
          }

          // 按钮点击事件
          domBtm.addEventListener("click", send);

          // 输入框回车键事件
          message.addEventListener("keypress", function (event) {
            if (event.key === "Enter") {
              send();
            }
          });
        }

        // 3. 根据疾病名称创建卡片并渲染症状
        function renderSymptomsByDiseaseName(diseaseName, symptoms) {
          // console.log(symptoms);
          createResultCard(diseaseName, symptoms);
        }

        // 4. 创建卡片
        function createResultCard(diseaseName, symptoms, isPredicted = false) {
          const resultContentContainer =
            document.querySelector(".result_content");

          const resultCard = document.createElement("div");
          resultCard.classList.add("result_card");

          const resultHeader = document.createElement("div");
          resultHeader.classList.add("result_header");

          if (isPredicted) {
            resultHeader.innerHTML = `Predicted Disease: ${diseaseName}`;
          } else {
            resultHeader.innerHTML = `Disease: ${diseaseName}`;
          }
          resultCard.appendChild(resultHeader);

          const resultMain = document.createElement("div");
          resultMain.classList.add("result_main");
          resultCard.appendChild(resultMain);

          const resultBriefIntro = document.createElement("div");
          resultBriefIntro.classList.add("result_brief_intro");
          resultBriefIntro.textContent = `Brief Explanation about ${diseaseName}...`;
          resultMain.appendChild(resultBriefIntro);

          const resultImage = document.createElement("div");
          resultImage.classList.add("result_image");
          const img = document.createElement("img");
          img.src = `./assets/images/disease.png`;
          img.alt = diseaseName;
          resultImage.appendChild(img);
          resultMain.appendChild(resultImage);

          const splitLine = document.createElement("div");
          splitLine.classList.add("split_line");
          resultMain.appendChild(splitLine);

          const symptomInfo = document.createElement("div");
          symptomInfo.classList.add("symptom_info");
          resultMain.appendChild(symptomInfo);

          const symptomIntro = document.createElement("div");
          symptomIntro.classList.add("symptom_intro");
          symptomIntro.textContent =
            "For the following symptoms, please select YES|NO|MAYBE according to your personal wellbeing";
          symptomInfo.appendChild(symptomIntro);

          const symptomListContainer = document.createElement("div");
          symptomListContainer.classList.add("symptom_list");
          symptomInfo.appendChild(symptomListContainer);

          // 生成唯一ID前缀
          const cardIdPrefix = `${diseaseName}_${new Date().getTime()}`;

          symptoms.forEach((symptom, index) => {
            const symptomItem = document.createElement("div");
            symptomItem.classList.add("simptom_item");

            const symptomName = `${symptom.SymptomName.replace(
              /\s+/g,
              "_"
            )}_${index}`;
            const uniqueSymptomId = `${cardIdPrefix}_${symptomName}`;

            symptomItem.innerHTML = `
      <div class="symptom_name">${symptom.SymptomName}</div>
      <div class="symptom_status">
          <input type="radio" id="${uniqueSymptomId}_yes" name="${uniqueSymptomId}" value="yes" />
          <label for="${uniqueSymptomId}_yes"></label>

          <input type="radio" id="${uniqueSymptomId}_no" name="${uniqueSymptomId}" value="no" />
          <label for="${uniqueSymptomId}_no"></label>

          <input type="radio" id="${uniqueSymptomId}_maybe" name="${uniqueSymptomId}" value="maybe" />
          <label for="${uniqueSymptomId}_maybe"></label>
      </div>
    `;
            symptomListContainer.appendChild(symptomItem);
          });

          const scrollArrow = document.createElement("div");
          scrollArrow.classList.add("scroll_arrow");
          resultCard.appendChild(scrollArrow);

          resultContentContainer.appendChild(resultCard);
        }

        // 5. 获取用户选择结果的函数
        function getUserSelections() {
          // 获取所有的症状项
          const symptomItems = document.querySelectorAll(".simptom_item");
          const userSelections = {};
          let allSelected = true;

          symptomItems.forEach((item) => {
            // 获取当前症状名称
            const symptomName = item.querySelector(".symptom_name").textContent;

            // 找到当前症状下用户选择的radio按钮
            const selectedOption = item.querySelector(
              'input[type="radio"]:checked'
            );

            // 获取选中的值（yes, no, maybe）
            const selectedValue = selectedOption ? selectedOption.value : null;

            // 将结果存储在对象中，键是症状名称，值是用户的选择
            userSelections[symptomName] = selectedValue;

            // 如果有未选择的选项，设置 allSelected 为 false
            if (!selectedValue) {
              allSelected = false;
            }
          });

          return { userSelections, allSelected };
        }
        // 调用
        const results = getUserSelections();
        // console.log(results);

        // 6. 症状匹配评分
        function calculateDiseaseScores(userSelections, diseasesData) {
          // 存储每个疾病的匹配分数
          const diseaseScores = {};

          // 遍历所有疾病
          for (const [diseaseName, diseaseInfo] of Object.entries(
            diseasesData
          )) {
            // 初始化当前疾病的匹配分数
            let score = 0;
            // 遍历当前疾病关联的所有症状
            diseaseInfo.Symptom.forEach((symptomInfo) => {
              const symptomName = symptomInfo.SymptomName;
              const symptomPossibility = symptomInfo.Possibility;
              // 根据症状名称从用户选择中获取用户的选择
              const userChoice = userSelections[symptomName];

              if (userChoice === "yes") {
                score += symptomPossibility;
              } else if (userChoice === "maybe") {
                score += symptomPossibility * 0.5;
              } else if (userChoice === "no") {
                return; // no 意味着没有这个症状，就是 0
              }
            });
            // 将当前疾病的最终得分存储到 diseaseScores 对象中
            diseaseScores[diseaseName] = score;
          }
          // 返回包含所有疾病匹配分数的对象
          return diseaseScores;
        }

        // 7. 关联症状到其他可能的疾病
        function findRelatedDiseases(userSelections, symptomsData) {
          // 存储相关疾病及其累积的可能性分数
          const relatedDiseases = {};

          // 遍历用户对症状的选择
          for (const [symptomName, choice] of Object.entries(userSelections)) {
            // 仅处理用户选择为 "yes" 或 "maybe" 的症状
            if (choice === "yes" || choice === "maybe") {
              // 从 symptomsData 中获取与当前症状相关的疾病信息
              const symptomInfo = symptomsData[symptomName];

              // 如果症状信息存在，则处理关联的疾病
              if (symptomInfo) {
                // 遍历当前症状关联的每个疾病
                symptomInfo.diseases.forEach((disease) => {
                  // 如果疾病还没有记录在 relatedDiseases 中，则初始化为 0
                  if (!relatedDiseases[disease.DiseaseName]) {
                    relatedDiseases[disease.DiseaseName] = 0;
                  }
                  // 根据用户选择累积该疾病的可能性分数
                  // "yes" 累积全额的可能性分数，"maybe" 累积一半的可能性分数
                  relatedDiseases[disease.DiseaseName] +=
                    disease.possibility * (choice === "yes" ? 1 : 0.5);
                });
              }
            }
          }
          // 返回包含所有相关疾病及其累积分数的对象
          return relatedDiseases;
        }

        // 8. 疾病排序与筛选
        function combineAndRankDiseases(
          diseaseScores,
          relatedDiseases,
          initialDisease
        ) {
          const combinedScores = { ...diseaseScores };

          for (const [diseaseName, score] of Object.entries(relatedDiseases)) {
            if (combinedScores[diseaseName]) {
              combinedScores[diseaseName] += score;
            } else {
              combinedScores[diseaseName] = score;
            }
          }

          return Object.entries(combinedScores)
            .filter(([diseaseName]) => diseaseName !== initialDisease) // 排除最初输入的疾病
            .sort((a, b) => b[1] - a[1]) // 从高到低排序
            .map(([diseaseName, score]) => ({ diseaseName, score }));
        }

        // 9. 迭代更新
        let predictionCount = 0;
        let finalResults = [];

        function onCardSwipe(
          userSelections,
          diseasesData,
          symptomsData,
          initialDisease
        ) {
          const diseaseScores = calculateDiseaseScores(
            userSelections,
            diseasesData
          );

          const relatedDiseases = findRelatedDiseases(
            userSelections,
            symptomsData
          );

          const rankedDiseases = combineAndRankDiseases(
            diseaseScores,
            relatedDiseases,
            initialDisease
          );

          if (rankedDiseases.length > 0) {
            // 找到第一个未在finalResults中出现的疾病
            let topDisease;
            for (const disease of rankedDiseases) {
              const isAlreadyPredicted = finalResults.some(
                (result) => result.diseaseName === disease.diseaseName
              );
              if (!isAlreadyPredicted) {
                topDisease = disease;
                break;
              }
            }

            // 如果找到未重复的疾病
            if (topDisease) {
              finalResults.push(topDisease);

              createResultCard(
                topDisease.diseaseName,
                diseasesData[topDisease.diseaseName].Symptom,
                true
              );

              predictionCount++;

              if (predictionCount === 5) {
                generateFinalReport(finalResults);
              }
            } else {
              console.log("No new unique diseases to predict.");
            }
          }
        }

        // 10. 生成最终报告
        function generateFinalReport(finalResults) {
          console.log("Final Results: ", finalResults);
          window.location.href = "pdf.html";
        }

        // 滚动停顿功能
        let isScrolling = false;
        let lastScrollTime = 0;
        const resultContent = document.querySelector(".result_content");

        function scrollToCard(targetCard) {
          isScrolling = true;
          targetCard.scrollIntoView({ behavior: "smooth" });

          setTimeout(() => {
            isScrolling = false;
          }, 1000);
        }

        function handleScroll(event) {
          if (isScrolling) {
            return;
          }

          const currentTime = new Date().getTime();
          if (currentTime - lastScrollTime < 1000) {
            event.preventDefault();
            return;
          }

          lastScrollTime = currentTime;

          const { userSelections, allSelected } = getUserSelections();

          if (!allSelected) {
            event.preventDefault();
            alert(
              "Please select an option for each symptom before proceeding."
            );
            return;
          }

          const resultCards = document.querySelectorAll(".result_card");

          let scrollDirection = event.deltaY < 0 ? "up" : "down";

          let closestCard = resultCards[0];
          let minDistance = Math.abs(closestCard.getBoundingClientRect().top);

          resultCards.forEach((card) => {
            const distance = Math.abs(card.getBoundingClientRect().top);
            if (distance < minDistance) {
              minDistance = distance;
              closestCard = card;
            }
          });

          let targetCard = closestCard;
          if (scrollDirection === "down") {
            const nextCard = closestCard.nextElementSibling;
            if (nextCard && nextCard.classList.contains("result_card")) {
              targetCard = nextCard;
            }
          } else {
            const prevCard = closestCard.previousElementSibling;
            if (prevCard && prevCard.classList.contains("result_card")) {
              targetCard = prevCard;
            }
          }

          // 执行进一步的逻辑处理（如创建新卡片）
          const initialDisease = document
            .querySelector(".result_card .result_header")
            .textContent.replace("Disease: ", "");
          onCardSwipe(
            userSelections,
            diseasesData,
            symptomsData,
            initialDisease
          );

          const newResultCards = document.querySelectorAll(".result_card");
          if (newResultCards.length > resultCards.length) {
            targetCard = newResultCards[newResultCards.length - 1];
          }

          scrollToCard(targetCard);
        }

        // 绑定滚动事件
        resultContent.addEventListener("wheel", function (event) {
          event.preventDefault();
          handleScroll(event);
        });
        // 初始化功能
        sendMessage("message_list_id", "button", "send_message_content");
        toggleSidebar("#toggleButton", "#sidebar");
      });
    </script>
  </body>
</html>
